<!DOCTYPE HTML>
<html>
	<head>
		<title>Series</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Intro -->
					<div id="intro">
						<h1>Welcome To <br />
						Series site</h1>
						<p> <br />
						</p>
					</div>

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo">Series</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li class="active"><a class="kol" href="index.html">Series</a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Featured Post -->
							<article class="post featured">
								<header class="major">
									<h2><a href="#">Available Series<br /></a></h2>
									<p>List of available Series</p>
									<ul id="you">
										<li><a onclick="clearGistProgress()" href="/Series/Flash/Flash.html">The Flash</a></li>
										<li><a onclick="clearGistProgress()" href="/Series/Bluelock/Bluelock.html">Bluelock</a></li>
										<li><a onclick="clearGistProgress()" href="/Series/Stranger%20Things/Stranger.html">Stranger Things</a></li>
										<li><a onclick="clearGistProgress()" href="/Series/Attack%20On%20Titan/Attack.html">Attack On Titan</a></li>
										<li><a onclick="clearGistProgress()" href="/Series/Prison%20Break/Prison.html">Prison Break</a></li>
									</ul>
								</header>
							</article>

							<script>
								var video = document.getElementById('my-video');
								document.addEventListener('DOMContentLoaded', function () {
								  var gistFilename = 'video_progress.json';
								  var isVideoPaused = false; // Track video pause/resume status
							
								  // Retrieve user credentials from sessionStorage
								  var username = sessionStorage.getItem('githubUsername');
								  var gistId = sessionStorage.getItem('githubGistId');
								  var accessToken = sessionStorage.getItem('githubAccessToken');
							
								  // If user credentials are not in sessionStorage, prompt for them
								  if (!username || !gistId || !accessToken) {
									username = prompt('Enter your GitHub username:');
									gistId = prompt('Enter your Gist ID:');
									accessToken = prompt('Enter your GitHub Personal Access Token:');
							
									// Save user credentials to sessionStorage
									sessionStorage.setItem('githubUsername', username);
									sessionStorage.setItem('githubGistId', gistId);
									sessionStorage.setItem('githubAccessToken', accessToken);
								  }
							
								  // Use the provided values for GitHub username, Gist ID, and token
								  var gistScript = document.createElement('script');
								  gistScript.src = `https://gist.github.com/${username}/${gistId}.js?access_token=${accessToken}`;
								  document.head.appendChild(gistScript);
							
								  // Handle saving and loading video playback progress
								  video.addEventListener('timeupdate', function () {
									// Check if the video is paused
									if (video.paused && !isVideoPaused) {
									  isVideoPaused = true;
									  // Save the progress to the Gist when paused
									  var progressData = {
										"progress": video.currentTime,
										"url": window.location.href // Add the URL here
									  };
									  var gistData = {
										"files": {
										  [gistFilename]: {
											"content": JSON.stringify(progressData, null, 2)
										  }
										}
									  };
									  fetch(`https://api.github.com/gists/${gistId}`, {
										method: 'PATCH',
										headers: {
										  'Authorization': 'token ' + `${accessToken}`,
										  'Content-Type': 'application/json',
										},
										body: JSON.stringify(gistData)
									  })
										.then(response => response.json())
										.then(data => console.log('Progress saved to Gist:', data));
									}
								  });
							
								  video.addEventListener('play', function () {
									// Video resumed playing, mark it as not paused
									isVideoPaused = false;
								  });
							
								  // Retrieve progress data from the Gist when the page loads
								  fetch(`https://api.github.com/gists/${gistId}`)
									.then(response => response.json())
									.then(data => {
									  if (data.files[gistFilename]) {
										var progressData = JSON.parse(data.files[gistFilename].content);
										if (progressData.progress) {
										  video.currentTime = parseFloat(progressData.progress);
										}
									  }
									});
							
								  // Clear user credentials from sessionStorage when the tab is closed
								  window.addEventListener('beforeunload', function () {
									sessionStorage.removeItem('githubUsername');
									sessionStorage.removeItem('githubGistId');
									sessionStorage.removeItem('githubAccessToken');
								  });
								});
							  </script>	
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
